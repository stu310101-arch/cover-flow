<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>生日快樂 & 新年快樂</title>
  <style>
    :root {
      --bg: #000;
      --cake: #f2b07d;
      --cake-shadow: rgba(0, 0, 0, 0.55);
      --cream: #ffffff;
      --pink: #ff5db1;
      --pink-deep: #ff2a9b;
      --tier-radius: 26px;
    }

    * { box-sizing: border-box; }

    html, body {
      height: 100%;
      margin: 0;
      background: var(--bg);
      overflow: hidden;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    .stage {
      position: relative;
      height: 100%;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    canvas#fw {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      z-index: 10;
      pointer-events: none;
    }

    .cake-wrap {
      position: relative;
      z-index: 5;
      width: min(92vw, 640px);
      height: min(90vh, 760px);
      display: flex;
      align-items: center;
      justify-content: center;
      padding-bottom: 0;
    }

    .cake-svg{
      display:block;
      width: min(92vw, 520px);
      height:auto;
      max-height: min(84vh, 640px);
      filter: drop-shadow(0 18px 22px rgba(0,0,0,0.65));
    }

    .cake {
      position: relative;
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: clamp(10px, 2.2vh, 16px);
      filter: drop-shadow(0 18px 22px rgba(0,0,0,0.65));
    }

    .tier {
      position: relative;
      background:
        radial-gradient(120% 70% at 50% 0%, rgba(255,255,255,0.35), rgba(255,255,255,0) 55%),
        linear-gradient(#f6c59c, #e8a871 60%, #dd9a61);
      border-radius: var(--tier-radius);
      box-shadow:
        0 12px 24px var(--cake-shadow),
        inset 0 10px 18px rgba(255,255,255,0.22);
      overflow: visible;
    }

    /* white cream top (with drips) */
    .tier::before {
      content: "";
      position: absolute;
      left: 0;
      right: 0;
      top: calc(-1 * clamp(14px, 2.6vh, 18px));
      height: clamp(28px, 5vh, 36px);
      background:
        radial-gradient(circle at 10% 80%, var(--cream) 0 14px, transparent 15px),
        radial-gradient(circle at 26% 85%, var(--cream) 0 16px, transparent 17px),
        radial-gradient(circle at 43% 78%, var(--cream) 0 14px, transparent 15px),
        radial-gradient(circle at 60% 88%, var(--cream) 0 18px, transparent 19px),
        radial-gradient(circle at 78% 80%, var(--cream) 0 14px, transparent 15px),
        radial-gradient(circle at 92% 88%, var(--cream) 0 16px, transparent 17px),
        linear-gradient(var(--cream), var(--cream));
      border-radius: calc(var(--tier-radius) + 8px);
      filter: drop-shadow(0 6px 10px rgba(0,0,0,0.35));
    }

    /* pink frosting ring */
    .tier::after {
      content: "";
      position: absolute;
      left: -8px;
      right: -8px;
      top: clamp(10px, 1.8vh, 14px);
      height: clamp(12px, 2.2vh, 16px);
      background:
        linear-gradient(90deg, rgba(255,255,255,0.25), rgba(255,255,255,0) 25%, rgba(255,255,255,0.22) 50%, rgba(255,255,255,0) 75%, rgba(255,255,255,0.18)),
        linear-gradient(var(--pink), var(--pink-deep));
      border-radius: 999px;
      box-shadow:
        inset 0 2px 0 rgba(255,255,255,0.35),
        0 8px 14px rgba(0,0,0,0.25);
      opacity: 0.98;
      pointer-events: none;
    }

    /* 第一層(最小) -> 第二層 -> 第三層(最大, 最下面) */
    .tier.top {
      width: clamp(210px, 46vw, 340px);
      height: clamp(110px, 16vh, 150px);
      z-index: 3;
    }

    .tier.mid {
      width: clamp(280px, 58vw, 460px);
      height: clamp(125px, 18vh, 170px);
      z-index: 2;
    }

    .tier.bottom {
      width: clamp(340px, 70vw, 560px);
      height: clamp(140px, 20vh, 200px);
      z-index: 1;
    }

    .plate {
      width: clamp(420px, 78vw, 660px);
      height: clamp(24px, 4.4vh, 34px);
      border-radius: 999px;
      background:
        radial-gradient(80% 140% at 50% 30%, rgba(255,255,255,0.35), rgba(255,255,255,0) 55%),
        linear-gradient(#222, #070707);
      box-shadow:
        0 16px 28px rgba(0,0,0,0.7),
        inset 0 2px 0 rgba(255,255,255,0.15);
      margin-top: clamp(6px, 1.2vh, 12px);
      opacity: 0.9;
    }

    /* 3 big cream dollops on the very top */
    .dollops {
      position: absolute;
      top: calc(-1 * clamp(46px, 6.2vh, 60px));
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      height: 60px;
      display: flex;
      justify-content: center;
      gap: clamp(10px, 2.5vw, 22px);
      pointer-events: none;
      z-index: 30;
    }

    .dollop {
      position: relative;
      width: clamp(46px, 8vw, 66px);
      height: clamp(46px, 8vw, 66px);
      border-radius: 50% 50% 48% 48%;
      background:
        radial-gradient(140% 120% at 35% 20%, rgba(255,255,255,0.95), rgba(255,255,255,0.88) 55%, rgba(255,255,255,0.82)),
        linear-gradient(#fff, #f2f2f2);
      filter: drop-shadow(0 8px 10px rgba(0,0,0,0.35));
    }

    .dollop::before {
      content: "";
      position: absolute;
      left: 50%;
      top: -18%;
      transform: translateX(-50%);
      width: 60%;
      height: 60%;
      border-radius: 60% 60% 55% 55%;
      background: linear-gradient(#fff, #f1f1f1);
    }

    /* Candles */
    .candles {
      position: absolute;
      left: 6%;
      right: 6%;
      top: clamp(-54px, -7.5vh, -40px);
      height: clamp(86px, 12.5vh, 112px);
      z-index: 40;
      pointer-events: none;
    }

    .candle {
      position: absolute;
      bottom: 0;
      width: clamp(8px, 1.6vw, 11px);
      height: clamp(34px, 6vh, 48px);
      border-radius: 999px;
      background:
        repeating-linear-gradient(135deg, rgba(255,255,255,0.65) 0 3px, rgba(255,255,255,0.05) 3px 6px),
        linear-gradient(#ffd5ea, #ff6fb8);
      box-shadow:
        inset 0 2px 0 rgba(255,255,255,0.45),
        0 10px 14px rgba(0,0,0,0.35);
      transform: translateX(-50%) rotate(var(--r, 0deg)) scale(var(--s, 1));
    }

    .wick {
      position: absolute;
      top: -8px;
      left: 50%;
      width: 2px;
      height: 8px;
      background: #1b1b1b;
      transform: translateX(-50%);
      border-radius: 4px;
    }

    .flame {
      position: absolute;
      top: -22px;
      left: 50%;
      width: 14px;
      height: 18px;
      transform: translateX(-50%);
      border-radius: 60% 60% 60% 60%;
      background:
        radial-gradient(circle at 35% 30%, #fff6bf 0 25%, rgba(255,246,191,0) 60%),
        radial-gradient(circle at 50% 55%, #ffb100 0 45%, rgba(255,177,0,0) 75%),
        radial-gradient(circle at 50% 85%, #ff4a00 0 55%, rgba(255,74,0,0) 85%);
      filter: drop-shadow(0 0 10px rgba(255, 210, 90, 0.55));
      animation: flicker 0.12s infinite alternate;
    }

    @keyframes flicker {
      0% { transform: translateX(-50%) rotate(-2deg) scale(1); opacity: 0.95; }
      100% { transform: translateX(-50%) rotate(2deg) scale(1.06); opacity: 1; }
    }

    @media (prefers-reduced-motion: reduce) {
      .flame { animation: none; }
    }
  </style>
</head>
<body>
  <div class="stage">
    <canvas id="fw"></canvas>

    <div class="cake-wrap" aria-hidden="true">
      <svg class="cake-svg" viewBox="0 0 600 600" xmlns="http://www.w3.org/2000/svg" aria-label="Birthday cake">
        <defs>
          <!-- Sprinkle clip areas (brown sides only) -->
          <clipPath id="clip-bottom" clipPathUnits="userSpaceOnUse">
            <rect x="125" y="395" width="350" height="120" rx="48" />
          </clipPath>
          <clipPath id="clip-mid" clipPathUnits="userSpaceOnUse">
            <rect x="185" y="305" width="230" height="78" rx="38" />
          </clipPath>
          <clipPath id="clip-top" clipPathUnits="userSpaceOnUse">
            <rect x="235" y="228" width="130" height="48" rx="26" />
          </clipPath>
        </defs>

        <!-- Plate -->
        <g stroke="#000" stroke-width="8" stroke-linecap="round" stroke-linejoin="round">
          <ellipse cx="300" cy="545" rx="250" ry="32" fill="#fff6fb"/>
          <ellipse cx="300" cy="545" rx="210" ry="22" fill="#ffe2ef"/>
        </g>

        <!-- BOTTOM TIER -->
        <g id="tier-bottom" stroke="#000" stroke-width="8" stroke-linecap="round" stroke-linejoin="round">
          <!-- cake side -->
          <rect x="110" y="360" width="380" height="170" rx="60" fill="#b2704c"/>
          <!-- sprinkles injected by JS -->
          <g id="sprinkles-bottom" clip-path="url(#clip-bottom)" stroke="none" stroke-width="0"></g>

          <!-- yellow filling band -->
          <path d="M140 402
                   C175 387 210 410 245 398
                   C275 388 310 410 340 398
                   C375 384 410 410 450 395
                   L450 425
                   C410 440 375 416 340 430
                   C310 442 275 418 245 432
                   C210 446 175 420 140 435
                   Z" fill="#f6e28a"/>

          <!-- icing top -->
          <ellipse cx="300" cy="355" rx="195" ry="52" fill="#f3a7b1"/>
          <!-- icing drips -->
          <path d="M125 356
                   C165 330 205 342 238 356
                   C255 364 252 392 235 402
                   C215 415 225 436 252 434
                   C282 432 275 405 298 404
                   C325 403 315 438 346 436
                   C376 434 364 404 392 402
                   C420 400 405 432 438 430
                   C468 428 470 403 455 392
                   C438 380 452 364 475 356
                   C438 338 405 340 372 353
                   C340 366 320 338 300 344
                   C270 354 235 332 125 356
                   Z" fill="#f3a7b1"/>

          <!-- blue ribbon band -->
          <path d="M125 468
                   C155 446 185 492 215 468
                   C245 444 275 492 305 468
                   C335 444 365 492 395 468
                   C425 444 455 492 485 468
                   L485 498
                   C455 520 425 470 395 498
                   C365 526 335 470 305 498
                   C275 526 245 470 215 498
                   C185 526 155 470 125 498
                   Z" fill="#2aa7ff"/>
          <path d="M125 486
                   C155 468 185 505 215 486
                   C245 467 275 505 305 486
                   C335 467 365 505 395 486
                   C425 467 455 505 485 486" fill="none" stroke="#0b6bbd" stroke-width="10"/>

          <!-- ribbon hanging tails -->
          <path d="M175 495
                   C165 528 185 545 200 560
                   C215 545 225 528 215 498
                   Z" fill="#2aa7ff"/>
          <path d="M425 495
                   C415 528 435 545 450 560
                   C465 545 475 528 465 498
                   Z" fill="#2aa7ff"/>
          <path d="M175 495
                   C165 528 185 545 200 560" fill="none" stroke="#0b6bbd" stroke-width="10"/>
          <path d="M425 495
                   C415 528 435 545 450 560" fill="none" stroke="#0b6bbd" stroke-width="10"/>

          <!-- bow -->
          <path d="M292 488
                   C260 470 242 456 232 468
                   C220 484 242 505 275 510
                   C290 512 300 506 300 498
                   C300 506 310 512 325 510
                   C358 505 380 484 368 468
                   C358 456 340 470 308 488
                   Z" fill="#2aa7ff"/>
          <circle cx="300" cy="492" r="16" fill="#0b6bbd"/>
        </g>

        <!-- MIDDLE TIER -->
        <g id="tier-mid" stroke="#000" stroke-width="8" stroke-linecap="round" stroke-linejoin="round">
          <rect x="165" y="275" width="270" height="120" rx="52" fill="#b2704c"/>
          <g id="sprinkles-mid" clip-path="url(#clip-mid)" stroke="none" stroke-width="0"></g>

          <path d="M190 312
                   C215 300 240 318 265 308
                   C290 298 315 318 340 308
                   C370 296 395 318 410 304
                   L410 332
                   C392 346 370 322 342 336
                   C316 350 290 324 266 340
                   C240 356 215 328 190 346
                   Z" fill="#f6e28a"/>

          <ellipse cx="300" cy="270" rx="140" ry="40" fill="#f3a7b1"/>
          <path d="M182 273
                   C205 252 235 260 260 272
                   C276 280 272 302 258 310
                   C244 318 254 336 274 334
                   C296 332 290 312 307 311
                   C326 310 320 338 342 336
                   C362 334 352 312 370 310
                   C388 308 380 332 403 330
                   C420 328 426 310 412 300
                   C398 290 410 280 418 274
                   C392 258 368 260 348 270
                   C328 280 318 258 300 264
                   C278 272 240 250 182 273
                   Z" fill="#f3a7b1"/>
        </g>

        <!-- TOP TIER -->
        <g id="tier-top" stroke="#000" stroke-width="8" stroke-linecap="round" stroke-linejoin="round">
          <rect x="215" y="200" width="170" height="85" rx="40" fill="#b2704c"/>
          <g id="sprinkles-top" clip-path="url(#clip-top)" stroke="none" stroke-width="0"></g>

          <path d="M235 230
                   C252 222 270 238 288 230
                   C306 222 324 238 342 230
                   C360 222 370 236 375 224
                   L375 248
                   C368 262 360 244 342 256
                   C324 268 306 248 288 260
                   C270 272 252 252 235 266
                   Z" fill="#f6e28a"/>

          <ellipse cx="300" cy="195" rx="92" ry="28" fill="#f3a7b1"/>
          <path d="M222 197
                   C238 183 258 188 275 196
                   C288 202 286 220 276 226
                   C266 232 272 246 288 245
                   C305 244 302 228 314 228
                   C328 228 326 248 344 246
                   C360 244 356 228 369 226
                   C382 224 378 240 388 238
                   C398 236 400 224 392 216
                   C384 208 392 202 395 198
                   C376 186 356 188 340 196
                   C324 204 316 188 300 192
                   C282 196 252 182 222 197
                   Z" fill="#f3a7b1"/>
        </g>

        <!-- CHERRIES -->
        <g id="cherries" stroke="#000" stroke-width="7" stroke-linecap="round" stroke-linejoin="round">
          <!-- bottom tier cherries -->
          <g>
            <circle cx="185" cy="320" r="16" fill="#e23b3b"/><circle cx="179" cy="314" r="5" fill="#ff9aa0" stroke="none"/>
            <circle cx="245" cy="312" r="16" fill="#e23b3b"/><circle cx="239" cy="306" r="5" fill="#ff9aa0" stroke="none"/>
            <circle cx="300" cy="318" r="16" fill="#e23b3b"/><circle cx="294" cy="312" r="5" fill="#ff9aa0" stroke="none"/>
            <circle cx="355" cy="312" r="16" fill="#e23b3b"/><circle cx="349" cy="306" r="5" fill="#ff9aa0" stroke="none"/>
            <circle cx="415" cy="320" r="16" fill="#e23b3b"/><circle cx="409" cy="314" r="5" fill="#ff9aa0" stroke="none"/>
          </g>

          <!-- mid tier cherries -->
          <g>
            <circle cx="225" cy="240" r="14" fill="#e23b3b"/><circle cx="220" cy="235" r="4.5" fill="#ff9aa0" stroke="none"/>
            <circle cx="275" cy="232" r="14" fill="#e23b3b"/><circle cx="270" cy="227" r="4.5" fill="#ff9aa0" stroke="none"/>
            <circle cx="325" cy="232" r="14" fill="#e23b3b"/><circle cx="320" cy="227" r="4.5" fill="#ff9aa0" stroke="none"/>
            <circle cx="375" cy="240" r="14" fill="#e23b3b"/><circle cx="370" cy="235" r="4.5" fill="#ff9aa0" stroke="none"/>
          </g>

          <!-- top tier cherries -->
          <g>
            <circle cx="265" cy="172" r="12" fill="#e23b3b"/><circle cx="261" cy="168" r="4" fill="#ff9aa0" stroke="none"/>
            <circle cx="300" cy="166" r="12" fill="#e23b3b"/><circle cx="296" cy="162" r="4" fill="#ff9aa0" stroke="none"/>
            <circle cx="335" cy="172" r="12" fill="#e23b3b"/><circle cx="331" cy="168" r="4" fill="#ff9aa0" stroke="none"/>
          </g>
        </g>

        <!-- CANDLES + FLAMES -->
        <g id="candles" stroke="#000" stroke-width="8" stroke-linecap="round" stroke-linejoin="round">
          <!-- candle bodies -->
          <g>
            <rect x="258" y="95" width="22" height="85" rx="8" fill="#fff6fb"/>
            <rect x="289" y="88" width="22" height="92" rx="8" fill="#fff6fb"/>
            <rect x="320" y="95" width="22" height="85" rx="8" fill="#fff6fb"/>

            <!-- stripes -->
            <path d="M258 120 L280 110" stroke="#ff6b7a" stroke-width="8"/>
            <path d="M258 145 L280 135" stroke="#ff6b7a" stroke-width="8"/>
            <path d="M258 170 L280 160" stroke="#ff6b7a" stroke-width="8"/>

            <path d="M289 115 L311 105" stroke="#ff6b7a" stroke-width="8"/>
            <path d="M289 140 L311 130" stroke="#ff6b7a" stroke-width="8"/>
            <path d="M289 165 L311 155" stroke="#ff6b7a" stroke-width="8"/>

            <path d="M320 120 L342 110" stroke="#ff6b7a" stroke-width="8"/>
            <path d="M320 145 L342 135" stroke="#ff6b7a" stroke-width="8"/>
            <path d="M320 170 L342 160" stroke="#ff6b7a" stroke-width="8"/>
          </g>

          <!-- wicks -->
          <path d="M269 90 C268 82 270 78 271 72" fill="none"/>
          <path d="M300 83 C299 75 301 71 302 65" fill="none"/>
          <path d="M331 90 C330 82 332 78 333 72" fill="none"/>

          <!-- flames -->
          <g>
            <path d="M271 66
                     C262 56 266 40 274 32
                     C283 42 286 56 271 66
                     Z" fill="#ffd05b"/>
            <path d="M271 62
                     C266 55 268 46 272 40
                     C277 46 279 55 271 62
                     Z" fill="#ff8a2a" stroke="none"/>

            <path d="M302 59
                     C293 49 297 33 305 25
                     C314 35 317 49 302 59
                     Z" fill="#ffd05b"/>
            <path d="M302 55
                     C297 48 299 39 303 33
                     C308 39 310 48 302 55
                     Z" fill="#ff8a2a" stroke="none"/>

            <path d="M333 66
                     C324 56 328 40 336 32
                     C345 42 348 56 333 66
                     Z" fill="#ffd05b"/>
            <path d="M333 62
                     C328 55 330 46 334 40
                     C339 46 341 55 333 62
                     Z" fill="#ff8a2a" stroke="none"/>
          </g>
        </g>
      </svg>
    </div>
  </div>

  <script>
    // --- Sprinkles (SVG) ---
    (function initSprinkles() {
      const svg = document.querySelector('.cake-svg');
      if (!svg) return;

      const ns = 'http://www.w3.org/2000/svg';

      // bright candy colors like the reference image
      const palette = [
        '#ff595e', '#ffca3a', '#8ac926', '#1982c4',
        '#6a4c93', '#ff7aa2', '#00d2d3', '#ff9f1a'
      ];

      // deterministic-ish randomness per load
      let seed = Math.floor(Math.random() * 1e9);
      const rand = () => {
        seed ^= seed << 13; seed ^= seed >>> 17; seed ^= seed << 5;
        return ((seed >>> 0) / 4294967296);
      };

      const configs = [
        { id: 'sprinkles-bottom', count: 190, rect: { x: 125, y: 395, w: 350, h: 120 } },
        { id: 'sprinkles-mid', count: 120, rect: { x: 185, y: 305, w: 230, h: 78 } },
        { id: 'sprinkles-top', count: 70, rect: { x: 235, y: 228, w: 130, h: 48 } },
      ];

      function pick(arr) { return arr[Math.floor(rand() * arr.length)]; }

      function addPill(g, cx, cy, w, h, rot, color) {
        const r = document.createElementNS(ns, 'rect');
        r.setAttribute('x', (cx - w / 2).toFixed(2));
        r.setAttribute('y', (cy - h / 2).toFixed(2));
        r.setAttribute('width', w.toFixed(2));
        r.setAttribute('height', h.toFixed(2));
        r.setAttribute('rx', (Math.min(w, h) * 0.5).toFixed(2));
        r.setAttribute('fill', color);
        r.setAttribute('stroke', 'none');
        r.setAttribute('transform', `rotate(${rot.toFixed(1)} ${cx.toFixed(2)} ${cy.toFixed(2)})`);
        g.appendChild(r);
      }

      function addDot(g, cx, cy, rad, color) {
        const c = document.createElementNS(ns, 'circle');
        c.setAttribute('cx', cx.toFixed(2));
        c.setAttribute('cy', cy.toFixed(2));
        c.setAttribute('r', rad.toFixed(2));
        c.setAttribute('fill', color);
        c.setAttribute('stroke', 'none');
        g.appendChild(c);
      }

      for (const cfg of configs) {
        const g = svg.querySelector(`#${cfg.id}`);
        if (!g) continue;
        g.replaceChildren();
        g.setAttribute('stroke', 'none');

        for (let i = 0; i < cfg.count; i++) {
          const x = cfg.rect.x + rand() * cfg.rect.w;
          const y = cfg.rect.y + rand() * cfg.rect.h;
          const color = pick(palette);

          if (rand() < 0.22) {
            addDot(g, x, y, 2.0 + rand() * 2.2, color);
          } else {
            const w = 5.5 + rand() * 7.5;
            const h = 2.6 + rand() * 2.2;
            const rot = rand() * 180;
            addPill(g, x, y, w, h, rot, color);
          }
        }
      }
    })();

    // --- Fireworks (canvas): white core + neon outline, multi-color per burst, slower + fewer ---
    (function fireworks() {
      const canvas = document.getElementById('fw');
      if (!(canvas instanceof HTMLCanvasElement)) return;
      const ctx = canvas.getContext('2d');
      if (!ctx) return;

      const DPR = () => Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      let w = 0, h = 0, dpr = DPR();

      function resize() {
        dpr = DPR();
        w = Math.floor(window.innerWidth);
        h = Math.floor(window.innerHeight);
        canvas.width = Math.floor(w * dpr);
        canvas.height = Math.floor(h * dpr);
        canvas.style.width = w + 'px';
        canvas.style.height = h + 'px';
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
      }
      resize();
      window.addEventListener('resize', resize, { passive: true });

      const bursts = [];

      // --- Tunables (per your feedback) ---
      const MIN_BURSTS = 2;              // 同時存在更少
      const MAX_BURSTS = 6;
      const SPAWN_MS_MIN = 950;          // 生成變慢
      const SPAWN_MS_MAX = 1650;

      const DOT_MS_MIN = 90;
      const DOT_MS_MAX = 140;

      const LIFE_MS_MIN = 1700;          // 消失變慢
      const LIFE_MS_MAX = 2600;

      const RAYS_MIN = 16;               // 線條稍少，但每條多色
      const RAYS_MAX = 24;

      const MAX_R_MIN = 58;
      const MAX_R_MAX = 112;

      const clamp01 = (x) => Math.max(0, Math.min(1, x));
      const randBetween = (a, b) => a + Math.random() * (b - a);
      const randInt = (a, b) => Math.floor(randBetween(a, b + 1));

      const easeInCubic = (t) => t * t * t;
      const easeInOutCubic = (t) => (t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2);

      const NEON_HUES = [25, 45, 65, 120, 155, 185, 205, 235, 270, 295, 315, 335];
      function neonColor(h) {
        const hue = ((h % 360) + 360) % 360;
        return `hsl(${hue} 100% 65%)`;
      }
      function neonFromPalette(jitter = 0) {
        const base = NEON_HUES[randInt(0, NEON_HUES.length - 1)];
        return neonColor(base + randBetween(-jitter, jitter));
      }

      function pickSpawn() {
        // "中心以外"：避開中心附近
        const cx = w / 2;
        const cy = h / 2;
        const minDist = Math.min(w, h) * 0.14;

        for (let tries = 0; tries < 40; tries++) {
          const x = randBetween(50, w - 50);
          const y = randBetween(50, h - 90);
          if (Math.hypot(x - cx, y - cy) >= minDist) return { x, y };
        }
        return { x: randBetween(50, w - 50), y: randBetween(50, h - 90) };
      }

      function spawnBurst(now) {
        const { x, y } = pickSpawn();
        const rays = randInt(RAYS_MIN, RAYS_MAX);
        const rot = randBetween(0, Math.PI * 2);
        const baseHue = randBetween(0, 360);

        const rayData = [];
        for (let k = 0; k < rays; k++) {
          const a = rot + (k / rays) * Math.PI * 2 + randBetween(-0.018, 0.018);

          // 同一個 burst：每條 ray 多色；同一條 ray 分段多色（2~3 段）
          const c1 = Math.random() < 0.5 ? neonFromPalette(14) : neonColor(baseHue + randBetween(-85, 85));
          const c2 = Math.random() < 0.5 ? neonFromPalette(14) : neonColor(baseHue + randBetween(-85, 85));
          const c3 = Math.random() < 0.55 ? neonFromPalette(14) : neonColor(baseHue + randBetween(-85, 85));
          rayData.push({ a, c1, c2, c3 });
        }

        const dotColors = [
          rayData[randInt(0, rayData.length - 1)].c1,
          rayData[randInt(0, rayData.length - 1)].c2,
        ];

        bursts.push({
          x, y,
          rays,
          rayData,
          maxR: randBetween(MAX_R_MIN, MAX_R_MAX),
          t0: now,
          dotMs: randBetween(DOT_MS_MIN, DOT_MS_MAX),
          lifeMs: randBetween(LIFE_MS_MIN, LIFE_MS_MAX),
          dotColors,
        });
      }

      function drawDot(b, age) {
        const p = clamp01(age / b.dotMs);
        const r = 1.8 + 3.8 * p;

        // neon under (multi-color)
        ctx.save();
        ctx.globalAlpha = 0.9;
        ctx.globalCompositeOperation = 'lighter';

        ctx.shadowBlur = 18;
        ctx.shadowColor = b.dotColors[0];
        ctx.fillStyle = b.dotColors[0];
        ctx.beginPath();
        ctx.arc(b.x, b.y, r + 2.4, 0, Math.PI * 2);
        ctx.fill();

        ctx.shadowBlur = 14;
        ctx.shadowColor = b.dotColors[1];
        ctx.fillStyle = b.dotColors[1];
        ctx.beginPath();
        ctx.arc(b.x, b.y, r + 1.2, 0, Math.PI * 2);
        ctx.fill();

        // white core over
        ctx.globalCompositeOperation = 'source-over';
        ctx.shadowBlur = 0;
        ctx.globalAlpha = 1;
        ctx.fillStyle = '#fff';
        ctx.beginPath();
        ctx.arc(b.x, b.y, r, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();
      }

      // initial (少一點)
      const tStart = performance.now();
      for (let i = 0; i < 2; i++) spawnBurst(tStart);
      let nextSpawn = tStart + randBetween(SPAWN_MS_MIN, SPAWN_MS_MAX);

      function loop(now) {
        ctx.clearRect(0, 0, w, h);

        // spawn control: 變少 + 降低頻率 + 上限控制
        if (now >= nextSpawn && bursts.length < MAX_BURSTS) {
          spawnBurst(now);
          nextSpawn = now + randBetween(SPAWN_MS_MIN, SPAWN_MS_MAX);
        } else if (now >= nextSpawn) {
          nextSpawn = now + randBetween(SPAWN_MS_MIN, SPAWN_MS_MAX);
        }

        for (let i = bursts.length - 1; i >= 0; i--) {
          const b = bursts[i];
          const age = now - b.t0;

          if (age < b.dotMs) {
            drawDot(b, age);
            continue;
          }

          const t = (age - b.dotMs) / b.lifeMs;
          if (t >= 1) {
            bursts.splice(i, 1);
            continue;
          }

          // 外擴速度不要太快：開頭更慢
          const outerT = easeInOutCubic(clamp01(t));
          const outer = b.maxR * (0.10 + 0.90 * outerT);

          // inside-out disappearance：延後開始 + 加速吃掉（內 -> 外）
          const innerT = easeInCubic(clamp01((t - 0.20) / 0.80));
          const inner = Math.min(outer, b.maxR * innerT * 1.18);

          const alpha = Math.max(0, 1 - Math.pow(t, 1.25));
          if (inner >= outer - 0.6) {
            bursts.splice(i, 1);
            continue;
          }

          ctx.lineCap = 'round';

          // neon under (多色：同一條 ray 分段不同色)
          ctx.save();
          ctx.globalCompositeOperation = 'lighter';
          ctx.globalAlpha = alpha * 0.92;
          ctx.lineWidth = 6.2;

          const mid1T = 0.46;
          const mid2T = 0.78;

          for (let k = 0; k < b.rays; k++) {
            const rd = b.rayData[k];
            const a = rd.a;

            const r1 = inner;
            const r2 = inner + (outer - inner) * mid1T;
            const r3 = inner + (outer - inner) * mid2T;
            const r4 = outer;

            const x1 = b.x + Math.cos(a) * r1;
            const y1 = b.y + Math.sin(a) * r1;
            const x2 = b.x + Math.cos(a) * r2;
            const y2 = b.y + Math.sin(a) * r2;
            const x3 = b.x + Math.cos(a) * r3;
            const y3 = b.y + Math.sin(a) * r3;
            const x4 = b.x + Math.cos(a) * r4;
            const y4 = b.y + Math.sin(a) * r4;

            ctx.shadowBlur = 18;

            ctx.strokeStyle = rd.c1;
            ctx.shadowColor = rd.c1;
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.stroke();

            ctx.strokeStyle = rd.c2;
            ctx.shadowColor = rd.c2;
            ctx.beginPath();
            ctx.moveTo(x2, y2);
            ctx.lineTo(x3, y3);
            ctx.stroke();

            ctx.strokeStyle = rd.c3;
            ctx.shadowColor = rd.c3;
            ctx.beginPath();
            ctx.moveTo(x3, y3);
            ctx.lineTo(x4, y4);
            ctx.stroke();
          }
          ctx.restore();

          // white core on top (保持：白線在上層)
          ctx.save();
          ctx.globalCompositeOperation = 'source-over';
          ctx.globalAlpha = alpha;
          ctx.strokeStyle = 'rgba(255,255,255,0.98)';
          ctx.lineWidth = 2.1;
          ctx.shadowBlur = 0;

          for (let k = 0; k < b.rays; k++) {
            const a = b.rayData[k].a;
            const x1 = b.x + Math.cos(a) * inner;
            const y1 = b.y + Math.sin(a) * inner;
            const x2 = b.x + Math.cos(a) * outer;
            const y2 = b.y + Math.sin(a) * outer;
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.stroke();
          }
          ctx.restore();
        }

        // keep some on screen, but fewer than before
        if (bursts.length < MIN_BURSTS && now - tStart > 250) {
          spawnBurst(now);
          nextSpawn = now + randBetween(SPAWN_MS_MIN, SPAWN_MS_MAX);
        }

        requestAnimationFrame(loop);
      }

      requestAnimationFrame(loop);
    })();
  </script>
</body>
</html>
